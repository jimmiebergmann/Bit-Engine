################################################
#
#	Bit Engine - System Makefile
#
################################################

CC				= g++
CCFLAGS			= -std=gnu++0x
CCPATHS			= include extlibs/include
AR				= ar rcs
RM				= rm -f
MKDIR			= mkdir -p
OBJ_PATH        = obj/Linux/32
LIB_PATH        = lib/Linux/32
LIB_NAME		= bit-system
EXTLIBS_PATH	= extlibs
DEBUG_POSTFIX	= -d



# All target
all: debug_static debug_dynamic release_static release_dynamic


# DEBUG targets
# Static DEBUG target
debug_static: CCFLAGS += -g -W -O0
debug_static: $(LIB_PATH)/$(LIB_NAME)$(DEBUG_POSTFIX).a


# Dynamic DEBUG target
debug_dynamic:
	@echo Not supporting $@ target yet

# RELEASE targets
# Static RELEASE target
release_static: $(LIB_PATH)/$(LIB_NAME).a

# Dynamic RELEASE target
release_dynamic:
	@echo Not supporting $@ target yet


# System targets
SYSTEM_CPP = $(shell find source/Bit/System -type f -name "*.cpp" )
SYSTEM_CPP += source/Bit/System.cpp
SYSTEM_OBJ_DEBUG_STATIC = $(addprefix $(OBJ_PATH)/debug_static/$(LIB_NAME)/, $(patsubst %.cpp, %.o, $(SYSTEM_CPP)))
SYSTEM_OBJ_RELEASE_STATIC = $(addprefix $(OBJ_PATH)/release_static/$(LIB_NAME)/, $(patsubst %.cpp, %.o, $(SYSTEM_CPP)))

# Static debug system target
$(LIB_PATH)/$(LIB_NAME)$(DEBUG_POSTFIX).a: $(SYSTEM_OBJ_DEBUG_STATIC)
	$(MKDIR) $(LIB_PATH)
	$(AR) $@ $^
# Static release system target
$(LIB_PATH)/$(LIB_NAME).a: $(SYSTEM_OBJ_RELEASE_STATIC)
	$(MKDIR) $(LIB_PATH)
	$(AR) $@ $^

# System objects
# Static debug system objects
$(OBJ_PATH)/debug_static/$(LIB_NAME)/%.o: %.cpp
	$(MKDIR) $(dir $@)
	$(CC) $(CCFLAGS) $(addprefix -I, $(CCPATHS)) -c $< -o $@
	@echo Compiling: $<

# Static release system objects
$(OBJ_PATH)/release_static/$(LIB_NAME)/%.o: %.cpp
	$(MKDIR) $(dir $@)
	$(CC) $(CCFLAGS) $(addprefix -I, $(CCPATHS)) -c $< -o $@
	@echo Compiling: $<



# Clean target
.PHONY: clean cleanall cleandebug_static cleandebug_release

clean:
	$(RM) -rf obj

cleanall: clean
	$(RM) -rf lib

cleandebug_static:
	$(RM) -rf $(OBJ_PATH)/debug_static

cleandebug_release:
	$(RM) -rf $(OBJ_PATH)/release_static